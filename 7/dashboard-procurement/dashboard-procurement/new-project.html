<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>ניהול פרויקטי רכש</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="shell">
    <aside class="sidebar">
      <div class="brand">FOREST • OPS</div>
      <nav class="side-icons">
        <a href="projects.html" class="icon-btn" title="רשימת פרויקטים">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"/></svg>
        </a>
        <a href="dashboard.html" class="icon-btn" title="דשבורד מנהלים">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 3h8v8H3V3zm10 0h8v8h-8V3zM3 13h8v8H3v-8zm10 0h8v8h-8v-8z"/></svg>
        </a>
        <a href="metrics.html" class="icon-btn" title="ניהול מדדים">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M4 19h16v2H4v-2zM7 10h2v7H7ו-7zm4-3h2v10h-2V7zm4 5h2v5h-2v-5z"/></svg>
        </a>
        <a href="new-project.html" class="icon-btn plus active" title="פתיחת פרויקט חדש">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2h6z"/></svg>
        </a>
      </nav>
      <div class="side-note">v2.7</div>
    </aside>
    <main class="page wizard-page">
      <div class="wizard-header">
        <h1>פרויקט חדש</h1>
        <div class="wizard-tabs" id="tabs">
          <button data-step="1" class="active">תיאור כללי</button>
          <button data-step="2">שיוך ארגוני</button>
          <button data-step="3">ניהול ההליך</button>
          <button data-step="4">תכנון מול ביצוע</button>
          <button data-step="5">ניהול משימות</button>
          <button data-step="6">תוצאות</button>
        </div>
      </div>
      <form id="create-form" autocomplete="off" class="panel panel--narrow">
        <!-- שלב 1: תיאור כללי -->
        <section class="step" data-step="1" style="grid-template-columns:repeat(4,minmax(220px,1fr))">
          <h2 class="group-title">תיאור כללי של הפרויקט</h2>
          <label>שנה
            <select id="c-year"></select>
          </label>
          <label>סוג פרויקט
            <select id="c-kind">
              <option value="">בחרי...</option>
              <option>פרויקט חדש</option>
              <option>המשך להתקשרות נוכחית</option>
            </select>
          </label>
          <label>סטטוס פרויקט
            <select id="c-projStatus">
              <option value="">—</option>
              <option>בתהליך</option><option>הסתיים</option>
              <option>לא התחיל</option><option>מבוטל</option><option>מוקפא</option>
            </select>
          </label>
          <label class="wide">נושא הפרויקט
            <div class="resizable-shell">
              <textarea id="c-subject" rows="1" class="resizable-like-select like-select"
                placeholder="לדוגמה: מכרז שירותי תחזוקה לאתרי צפון"></textarea>
              <span class="grip" aria-hidden="true"></span>
            </div>
          </label>
          <!-- **** עבר לפה: פרטי התקשרות נוכחית (נפתח רק אם kind='המשך להתקשרות נוכחית') **** -->
          <div id="block-current" class="hidden group-title" style="margin-top:2px">פרטי התקשרות נוכחית</div>
          <div class="form-grid hidden" id="current-grid" style="grid-template-columns:repeat(4,minmax(220px,1fr))">
            <label>מס׳ הזמנה נוכחי<input id="c-currentOrderNo" type="text"/></label>
            <label>כמות ספקים נוכחיים<input id="c-suppliersCount" type="number" min="0" max="20" /></label>
            <input id="c-currentSuppliers" type="hidden"/>
            <div id="suppliers-list" class="wide"></div>
            <label>היקף תקופתי (הזמנות במערכת)<input id="c-currentPeriodic" type="number"/></label>
            <label>סה״כ שנים להסכם/הזמנה<input id="c-totalYearsCurrent" type="number"/></label>
            <label>היקף שנתי (מחושב)<input id="c-currentAnnual" type="number" disabled/></label>
            <label>מועד סיום התקשרות<input id="c-currentEnd" type="date"/></label>
          </div>
          <!-- **** סוף החלק שהועבר **** -->
        </section>
        <!-- שלב 2: שיוך ארגוני -->
        <section class="step hidden" data-step="2">
          <h2 class="group-title">שיוך ארגוני</h2>
          <div class="org-grid">
            <label>שטח רכש
              <select id="c-area">
                <option value="">בחרי...</option>
                <option>שטח רכש מנהלי</option>
                <option>שטח רכש פרויקטלי</option>
              </select>
            </label>
            <label>מחלקה ברכש
              <select id="c-dept">
                <option value="">בחרי...</option>
                <option>מחלקה 1</option><option>מחלקה 2</option>
              </select>
            </label>
            <label>תחום ברכש
              <select id="c-domain">
                <option value="">בחרי...</option>
                <option>תחום א</option><option>תחום ב</option>
              </select>
            </label>
            <label>אחראי רכש (קניין)
              <select id="c-buyer">
                <option value="">בחרי...</option>
                <option>עדן</option><option>אורה</option><option>מוריה</option><option>שירלי</option>
              </select>
            </label>
            <div class="row-2">
              <label>חטיבה מזמינה
                <select id="c-division">
                  <option value="">בחרי...</option>
                  <option>חטיבה 1</option><option>חטיבה 2</option><option>חטיבה 3</option><option>חטיבה 4</option>
                </select>
              </label>
              <label>יחידה מזמינה
                <select id="c-unit">
                  <option value="">בחרי...</option>
                  <option>יחידה 1</option><option>יחידה 2</option><option>יחידה 3</option><option>יחידה 4</option>
                </select>
              </label>
              <label>מפקח עבודה
                <input id="c-supervisor" type="text" placeholder="שם המפקח/ת"/>
              </label>
            </div>
          </div>
        </section>
        <!-- שלב 3: ניהול ההליך (דינמי) -->
        <section class="step hidden" data-step="3" style="grid-template-columns:repeat(4,minmax(220px,1fr))">
          <h2 class="group-title">ניהול ההליך</h2>
          <label>סוג הליך
            <select id="c-activity">
              <option value="">בחרי...</option>
              <option>מכרז</option><option>תחרות</option><option>ספק יחיד</option>
              <option>הארכת תוקף</option><option>הארכה/הגדלה</option><option>חשכ״ל</option>
              <option>מימוש אופציה</option><option>בדיקה הנדסית</option><option>ניהול משבר</option>
            </select>
          </label>
          <!-- תתי-שדות למכרז -->
          <label class="only-tender hidden">סוג מכרז
            <select id="c-tenderType">
              <option value="">בחרי...</option>
              <option>אסטרטגי</option><option>חד-שלבי</option><option>דו-שלבי</option>
            </select>
          </label>
          <label class="only-tender hidden">תחום מכרז
            <select id="c-tenderDomain">
              <option value="">בחרי...</option>
              <option>הסכמי מסגרת</option><option>בינוי</option><option>שירותים</option>
            </select>
          </label>
          <!-- *** שימו לב: פרטי התקשרות נוכחית הועברו לשלב 1, לכן הוסרו מכאן *** -->
          <!-- נתוני הליך תחרותי/מכרזי (למדדים) -->
          <div id="group-competitive" class="hidden group-title" style="margin-top:2px">נתוני הליך תחרותי</div>
          <div class="form-grid hidden" id="competitive-grid" style="grid-template-columns:repeat(4,minmax(220px,1fr))">
            <label>אומדן תקופתי<input id="c-estimatePeriodic" type="number"/></label>
            <label>שנים להזמנה<input id="c-agreementYears" type="number"/></label>
            <label>שנות אופציה<input id="c-optionYears" type="number"/></label>
            <label>סה״כ שנים<input id="c-totalYears" type="text" disabled/></label>
            <label class="wide">אומדן שנתי (מחושב)<input id="c-annualEstimate" type="number" disabled/></label>
          </div>
          <!-- זוכים -->
          <div id="results-competitive" class="hidden group-title" style="margin-top:2px">תוצאות הליך תחרותי</div>
          <div class="form-grid hidden" id="results-competitive-grid" style="grid-template-columns:repeat(4,minmax(220px,1fr))">
            <label>הצעה זוכה – תקופתי (₪)<input id="c-winningPeriodic" type="number"/></label>
            <label>הצעה זוכה – שנתי (₪)<input id="c-winningAnnual" type="number"/></label>
            <input id="c-winnersNames" type="hidden"/>
            <div id="winners-list" class="wide"></div>
          </div>
        </section>
        <!-- שלב 4: תכנון מול ביצוע (שני שדות חובה) -->
        <section class="step hidden" data-step="4" style="grid-template-columns:repeat(4,minmax(220px,1fr))">
          <h2 class="group-title">תכנון מול ביצוע</h2>
          <label>מועד התחלה מתוכנן
            <input id="c-planStart" type="date" data-protected="true" required />
          </label>
          <label>מועד סיום מתוכנן
            <input id="c-planEnd" type="date" data-protected="true" required />
          </label>
          <label>מועד התחלה בפועל
            <input id="c-actualStart" type="date" />
          </label>
          <label>מועד סיום בפועל
            <input id="c-actualEnd" type="date" />
          </label>
        </section>
        <!-- שלב 5: ניהול משימות -->
        <section class="step hidden" data-step="5" style="grid-template-columns:repeat(4,minmax(220px,1fr))">
          <h2 class="group-title">ניהול משימות</h2>
          <label class="wide">משימה<input id="c-task" type="text" placeholder="תיאור קצר"/></label>
          <label>אחראי משימה<input id="c-taskOwner" type="text"/></label>
          <label>לוז משימה (תאריך יעד)<input id="c-taskDue" type="date"/></label>
          <label>סטטוס משימה
            <select id="c-taskStatus">
              <option value="">—</option>
              <option>לא התחיל</option><option>בתהליך</option><option>הושלם</option><option>בחריגה</option>
            </select>
          </label>
          <label class="wide">הערות<input id="c-notes" type="text"/></label>
        </section>
        <!-- שלב 6: תוצאות -->
        <section class="step hidden" data-step="6" style="grid-template-columns:repeat(4,minmax(220px,1fr))">
          <h2 class="group-title">תוצאות</h2>
          <label>סטטוס פרויקט (סיום)
            <select id="c-projStatus-result">
              <option value="">—</option>
              <option>בתהליך</option><option>הסתיים</option>
              <option>לא התחיל</option><option>מבוטל</option><option>מוקפא</option>
            </select>
          </label>
          <label>מועד סיום בפועל (שיקוף)<input id="c-actualEnd-mirror" type="date"/></label>
          <label>מס׳ הזמנה חדשה<input id="c-newOrderNo" type="text"/></label>
        </section>
        <!-- כפתור יחיד -->
        <div class="wizard-nav">
          <button type="submit" id="saveProject" class="primary">שמירה</button>
        </div>
      </form>
    </main>
  </div>
  <!-- modal אימות מנהל (שקט) -->
  <div class="modal" id="admin-modal" aria-hidden="true">
    <div class="modal-card">
      <h3>אימות מנהל</h3>
      <label>הזיני קוד מנהל
        <input type="password" id="admin-code" placeholder="1234" />
      </label>
      <div class="modal-actions">
        <button type="button" id="admin-cancel" class="ghost">ביטול</button>
        <button type="button" id="admin-confirm" class="primary">אישור</button>
      </div>
    </div>
  </div>
  <script src="app.js"></script>
  <script>initNewProjectPage();</script>
</body>
</html>